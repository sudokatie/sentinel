{{define "settings.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Sentinel</title>
    <link rel="icon" type="image/svg+xml" href="{{.BasePath}}/static/favicon.svg">
    <link rel="stylesheet" href="{{.BasePath}}/static/css/style.css">
</head>
<body>
    <header>
        <a href="{{.BasePath}}/" class="logo">Sentinel</a>
        <button class="menu-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">///</button>
        <div class="nav-links">
            <a href="{{.BasePath}}/">Dashboard</a>
            <a href="{{.BasePath}}/settings">Settings</a>
            <a href="{{.BasePath}}/logout">Logout</a>
        </div>
    </header>
    <main>
        <div class="settings">
            <h1>Settings</h1>

            <div class="theme-toggle">
                <label>Theme</label>
                <div class="theme-switch">
                    <button data-theme="dark" onclick="setTheme('dark')">Dark</button>
                    <button data-theme="light" onclick="setTheme('light')">Light</button>
                </div>
            </div>

            {{if .Message}}
            <div class="alert success">{{.Message}}</div>
            {{end}}
            {{if .Error}}
            <div class="alert error">{{.Error}}</div>
            {{end}}

            <section>
                <h2>Add New Check</h2>
                <form action="{{.BasePath}}/settings/checks" method="POST" class="check-form">
                    <div class="form-group">
                        <label for="name">Check Name</label>
                        <input type="text" id="name" name="name" required placeholder="API Health">
                    </div>
                    <div class="form-group">
                        <label for="url">Target URL</label>
                        <input type="url" id="url" name="url" required placeholder="https://api.example.com/health">
                    </div>
                    <div class="form-group">
                        <label for="interval">Interval (Seconds)</label>
                        <input type="number" id="interval" name="interval" value="3600" min="10" max="86400">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Check</button>
                </form>
            </section>

            {{if .AlertConfig}}
            <section>
                <h2>Alert Configuration</h2>
                <div class="config-grid">
                    <div class="config-item">
                        <label>Consecutive Failures</label>
                        <span>{{.AlertConfig.ConsecutiveFailures}}</span>
                    </div>
                    <div class="config-item">
                        <label>Recovery Notifications</label>
                        <span>{{if .AlertConfig.RecoveryNotification}}Enabled{{else}}Disabled{{end}}</span>
                    </div>
                    <div class="config-item">
                        <label>Alert Cooldown</label>
                        <span>{{.AlertConfig.CooldownMinutes}} min</span>
                    </div>
                    <div class="config-item">
                        <label>Email Alerts</label>
                        <span>{{if .AlertConfig.EmailEnabled}}Enabled{{else}}Disabled{{end}}</span>
                    </div>
                    {{if .AlertConfig.EmailEnabled}}
                    <div class="config-item">
                        <label>SMTP Host</label>
                        <span>{{.AlertConfig.SMTPHost}}:{{.AlertConfig.SMTPPort}}</span>
                    </div>
                    <div class="config-item">
                        <label>From Address</label>
                        <span>{{.AlertConfig.FromAddress}}</span>
                    </div>
                    <div class="config-item">
                        <label>Recipients</label>
                        <span>{{range $i, $addr := .AlertConfig.ToAddresses}}{{if $i}}, {{end}}{{$addr}}{{end}}</span>
                    </div>
                    {{end}}
                </div>
                <p class="config-note">Edit sentinel.yaml to modify alert settings</p>
            </section>
            {{end}}

            {{if .RetentionConfig}}
            <section>
                <h2>Data Retention</h2>
                <div class="config-grid">
                    <div class="config-item">
                        <label>Keep Results</label>
                        <span>{{.RetentionConfig.ResultsDays}} days</span>
                    </div>
                    <div class="config-item">
                        <label>Keep Aggregates</label>
                        <span>{{.RetentionConfig.AggregatesDays}} days</span>
                    </div>
                </div>
                <p class="config-note">Edit sentinel.yaml to modify retention settings</p>
            </section>
            {{end}}

            <section>
                <h2>Active Checks</h2>
                {{if .Checks}}
                <div class="checks-cards">
                    {{range .Checks}}
                    <div class="check-card-settings">
                        <div class="check-card-header">
                            <span class="check-card-name">{{.Name}}</span>
                            {{if .Enabled}}
                            <span class="badge enabled">Active</span>
                            {{else}}
                            <span class="badge disabled">Inactive</span>
                            {{end}}
                        </div>
                        <div class="check-card-url">{{.URL}}</div>
                        <div class="check-card-meta">
                            Interval: {{.IntervalSecs}}s
                        </div>
                        <div class="check-card-actions">
                            <a href="{{$.BasePath}}/settings/checks/{{.ID}}/edit" class="btn btn-small">Edit</a>
                            <form action="{{$.BasePath}}/settings/checks/{{.ID}}/delete" method="POST" class="delete-form" onsubmit="return confirm('Delete this check?');">
                                <button type="submit" class="btn btn-danger btn-small">Delete</button>
                            </form>
                        </div>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="no-checks">
                    No checks configured. Add one above.
                </div>
                {{end}}
            </section>
        </div>
    </main>
    <footer>
        Uptime Monitor
    </footer>
    <script src="{{.BasePath}}/static/js/app.js"></script>
</body>
</html>
{{end}}
